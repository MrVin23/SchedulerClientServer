@page "/authorization-diagram"
@layout StoryLayout

<PageTitle>Authorization System Diagram</PageTitle>

<div class="container-fluid py-4">
    <div class="card shadow-sm mb-4">
        <div class="card-body text-center">
            <h3 class="mb-2">Dynamic Role-Based Authorization</h3>
            <h6 class="text-success">with Policy-Based Authentication</h6>
        </div>
    </div>

    @* Overview Section *@
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="mb-3">
                <i class="bi bi-info-circle text-success me-2"></i>
                Overview
            </h5>
            <p class="mb-0">
                This system combines role-based and policy-based authentication to create a flexible, 
                database-driven authorization system where admins can manage user roles and permissions 
                without requiring code changes.
            </p>
        </div>
    </div>

    @* Benefits Section *@
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="mb-4">
                <i class="bi bi-check-circle text-success me-2"></i>
                Architecture Benefits
            </h5>
            <div class="row">
                <div class="col-12 col-sm-6 col-md-4 mb-3">
                    <div class="text-center p-3">
                        <i class="bi bi-sliders text-success fs-2"></i>
                        <h6 class="mt-2 mb-1">Flexibility</h6>
                        <small class="text-muted">Admins can change permissions without code changes</small>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-md-4 mb-3">
                    <div class="text-center p-3">
                        <i class="bi bi-graph-up text-success fs-2"></i>
                        <h6 class="mt-2 mb-1">Scalability</h6>
                        <small class="text-muted">Easy to add new roles and permissions</small>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-md-4 mb-3">
                    <div class="text-center p-3">
                        <i class="bi bi-shield-lock text-danger fs-2"></i>
                        <h6 class="mt-2 mb-1">Security</h6>
                        <small class="text-muted">Centralized permission management</small>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-md-4 mb-3">
                    <div class="text-center p-3">
                        <i class="bi bi-tools text-warning fs-2"></i>
                        <h6 class="mt-2 mb-1">Maintainability</h6>
                        <small class="text-muted">Clear separation between roles and permissions</small>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-md-4 mb-3">
                    <div class="text-center p-3">
                        <i class="bi bi-speedometer2 text-info fs-2"></i>
                        <h6 class="mt-2 mb-1">Performance</h6>
                        <small class="text-muted">Database queries optimized and cacheable</small>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-md-4 mb-3">
                    <div class="text-center p-3">
                        <i class="bi bi-lightning text-success fs-2"></i>
                        <h6 class="mt-2 mb-1">Real-time</h6>
                        <small class="text-muted">Changes take effect immediately</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @* Database Structure Diagram *@
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="mb-4">
                <i class="bi bi-database text-success me-2"></i>
                Database Structure
            </h5>
            
            <div class="d-flex flex-wrap align-items-center justify-content-center gap-3">
                @* User Entity *@
                <div class="card border-primary" style="min-width: 120px;">
                    <div class="card-header bg-primary text-white py-2">
                        <i class="bi bi-person me-1"></i> User
                    </div>
                    <div class="card-body py-2 small">
                        <div>Username</div>
                        <div>Email</div>
                        <div>Password</div>
                        <div class="text-primary">UserRoles</div>
                    </div>
                </div>

                <div class="text-center">
                    <i class="bi bi-arrow-right"></i>
                    <div class="small text-muted">Many-to-Many</div>
                </div>

                @* UserRole Junction *@
                <div class="card border-secondary" style="min-width: 100px;">
                    <div class="card-header bg-secondary text-white py-2">
                        <i class="bi bi-link me-1"></i> UserRole
                    </div>
                    <div class="card-body py-2 small">
                        <div class="text-muted">UserId (FK)</div>
                        <div class="text-muted">RoleId (FK)</div>
                    </div>
                </div>

                <div class="text-center">
                    <i class="bi bi-arrow-right"></i>
                    <div class="small text-muted">Many-to-Many</div>
                </div>

                @* Role Entity *@
                <div class="card border-success" style="min-width: 120px;">
                    <div class="card-header bg-success text-white py-2">
                        <i class="bi bi-person-badge me-1"></i> Role
                    </div>
                    <div class="card-body py-2 small">
                        <div>Name</div>
                        <div>Description</div>
                        <div class="text-success">UserRoles</div>
                        <div class="text-success">RolePermissions</div>
                    </div>
                </div>

                <div class="text-center">
                    <i class="bi bi-arrow-right"></i>
                    <div class="small text-muted">Many-to-Many</div>
                </div>

                @* RolePermission Junction *@
                <div class="card border-secondary" style="min-width: 120px;">
                    <div class="card-header bg-secondary text-white py-2">
                        <i class="bi bi-link me-1"></i> RolePermission
                    </div>
                    <div class="card-body py-2 small">
                        <div class="text-muted">RoleId (FK)</div>
                        <div class="text-muted">PermissionId (FK)</div>
                    </div>
                </div>

                <div class="text-center">
                    <i class="bi bi-arrow-right"></i>
                    <div class="small text-muted">Many-to-Many</div>
                </div>

                @* Permission Entity *@
                <div class="card border-warning" style="min-width: 120px;">
                    <div class="card-header bg-warning text-dark py-2">
                        <i class="bi bi-key me-1"></i> Permission
                    </div>
                    <div class="card-body py-2 small">
                        <div>Name</div>
                        <div>Description</div>
                        <div class="text-warning">RolePermissions</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @* Authorization Flow *@
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="mb-4">
                <i class="bi bi-diagram-3 text-success me-2"></i>
                Authorization Flow
            </h5>
            
            <div class="row text-center">
                <div class="col">
                    <div class="badge bg-primary fs-6 mb-2">1</div>
                    <div class="p-3 border rounded">
                        <i class="bi bi-person text-success fs-4"></i>
                        <h6 class="mt-2">User Request</h6>
                        <small class="text-muted">User sends request to protected endpoint</small>
                    </div>
                </div>
                <div class="col-auto d-flex align-items-center">
                    <i class="bi bi-arrow-right fs-4"></i>
                </div>
                <div class="col">
                    <div class="badge bg-danger fs-6 mb-2">2</div>
                    <div class="p-3 border rounded">
                        <i class="bi bi-shield-check text-danger fs-4"></i>
                        <h6 class="mt-2">Policy Check</h6>
                        <small class="text-muted">[Authorize(Policy = "...")]</small>
                    </div>
                </div>
                <div class="col-auto d-flex align-items-center">
                    <i class="bi bi-arrow-right fs-4"></i>
                </div>
                <div class="col">
                    <div class="badge bg-info fs-6 mb-2">3</div>
                    <div class="p-3 border rounded">
                        <i class="bi bi-database text-info fs-4"></i>
                        <h6 class="mt-2">Database Query</h6>
                        <small class="text-muted">User → Roles → Permissions</small>
                    </div>
                </div>
                <div class="col-auto d-flex align-items-center">
                    <i class="bi bi-arrow-right fs-4"></i>
                </div>
                <div class="col">
                    <div class="badge bg-warning fs-6 mb-2">4</div>
                    <div class="p-3 border rounded">
                        <i class="bi bi-question-circle text-warning fs-4"></i>
                        <h6 class="mt-2">Has Permission?</h6>
                        <div class="mt-2">
                            <span class="badge bg-success me-1"><i class="bi bi-check"></i> Yes: Access</span>
                            <span class="badge bg-danger"><i class="bi bi-x"></i> No: Denied</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @* Key Takeaways *@
    <div class="card shadow-sm mb-4 bg-light">
        <div class="card-body">
            <h5 class="text-center mb-4">
                <i class="bi bi-star text-warning me-2"></i>
                Key Takeaways
            </h5>
            <div class="row justify-content-center">
                <div class="col-12 col-sm-6 col-md-4 mb-2">
                    <div class="alert alert-success mb-0">
                        <i class="bi bi-check-circle me-2"></i>
                        Dynamic: No code changes needed
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-md-4 mb-2">
                    <div class="alert alert-info mb-0">
                        <i class="bi bi-people me-2"></i>
                        Flexible: Multiple roles per user
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-md-4 mb-2">
                    <div class="alert alert-warning mb-0">
                        <i class="bi bi-lightning me-2"></i>
                        Real-time: Immediate effect
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
