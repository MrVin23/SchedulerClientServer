<div class="@GetContainerCssClasses()" style="@GetContainerStyle()" @onclick="HandleDayClick" role="button" tabindex="0" @onkeydown="HandleKeyDown">
    <div class="day-header @HeaderCssClasses">@Date.ToString("dd")</div>
    <div class="day-content @ContentCssClasses">
        @if (ChildContent is not null)
        {
            @ChildContent
        }
    </div>
</div>

@code {
    // Parameters
    [Parameter] public DateTime Date { get; set; }
    [Parameter] public List<string> Allocations { get; set; } = new();
    [Parameter] public RenderFragment? ChildContent { get; set; }

    // Styling Parameters
    [Parameter] public string AdditionalCssClasses { get; set; } = string.Empty;
    [Parameter] public string HeaderCssClasses { get; set; } = string.Empty;
    [Parameter] public string ContentCssClasses { get; set; } = string.Empty;
    [Parameter] public string MinimumHeight { get; set; } = "150px";
    [Parameter] public string MaximumHeight { get; set; } = "150px";
    [Parameter] public string MinimumWidth { get; set; } = "100px";
    [Parameter] public string MaximumWidth { get; set; } = "100px";
    public bool IsToday => Date.Date == DateTime.Today;
    public bool IsWeekend => Date.DayOfWeek == DayOfWeek.Saturday || Date.DayOfWeek == DayOfWeek.Sunday;
    public bool IsCurrentMonth => Date.Month == DateTime.Today.Month;
    [Parameter] public bool IsPublicHoliday { get; set; } = false;
    [Parameter] public bool IsSpecialDay { get; set; } = false;
    [Parameter] public bool IsSelected { get; set; } = false;
    [Parameter] public EventCallback<DateTime> OnDayClick { get; set; }
    
    // Methods
    public string GetDay(DateTime date)
    {
        // Return the day of the week as a string based on the Date parameter

        return "Todo";
    }

    private string GetContainerCssClasses()
    {
        var classes = new List<string> { "day" };
        if (IsToday) classes.Add("today");
        if (IsWeekend) classes.Add("weekend");
        if (IsPublicHoliday) classes.Add("holiday");
        if (IsSpecialDay) classes.Add("special");
        if (!IsCurrentMonth) classes.Add("not-current-month");
        if (IsSelected) classes.Add("selected");
        if (!string.IsNullOrWhiteSpace(AdditionalCssClasses)) classes.Add(AdditionalCssClasses);
        return string.Join(" ", classes);
    }

    private async Task HandleDayClick()
    {
        if (OnDayClick.HasDelegate)
        {
            await OnDayClick.InvokeAsync(Date);
        }
    }

    private async Task HandleKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Enter" || e.Key == " ")
        {
            await HandleDayClick();
        }
    }

    private string GetContainerStyle()
    {
        var styles = new List<string>();
        if (!string.IsNullOrWhiteSpace(MinimumHeight)) styles.Add($"min-height: {MinimumHeight}");
        if (!string.IsNullOrWhiteSpace(MaximumHeight)) styles.Add($"max-height: {MaximumHeight}");
        if (!string.IsNullOrWhiteSpace(MinimumWidth)) styles.Add($"min-width: {MinimumWidth}");
        if (!string.IsNullOrWhiteSpace(MaximumWidth)) styles.Add($"max-width: {MaximumWidth}");
        return string.Join("; ", styles);
    }
}