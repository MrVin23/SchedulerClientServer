@using Client.Components.Schedule

@* Weekly schedule grid component *@
<div class="week-grid @ThemeClass">
    @* Time column *@
    <div class="time-column">
        <div class="corner-cell">
            <i class="bi bi-clock"></i>
        </div>
        @foreach (var slot in TimeSlots)
        {
            <div class="time-slot" style="height: @(SlotHeightPx)px;">
                <span class="time-label">@slot.ToString(@"hh\:mm")</span>
            </div>
        }
    </div>

    @* Day columns *@
    @foreach (var day in WeekDays)
    {
        var isToday = day.Date == DateTime.Today;
        var dayEntries = GetEntriesForDay(day);

        <div class="day-column @(isToday ? "today" : "")">
            <div class="day-header @(isToday ? "today" : "")">
                <span class="day-name">@day.ToString("ddd")</span>
                <span class="day-number">@day.Day</span>
            </div>

            <div class="day-body" style="height: @(TotalGridHeight)px;">
                @* Grid lines for each time slot *@
                @foreach (var slot in TimeSlots)
                {
                    <div class="grid-line" style="top: @(CalculateTopPosition(slot))px;"></div>
                }

                @* Schedule entries (grouped by time slot) *@
                @foreach (var group in GetGroupedEntriesForDay(day))
                {
                    var mainEntry = GetMainEntry(group);
                    var alternates = GetAlternateEntries(group, mainEntry);
                    var top = CalculateTopPosition(mainEntry.StartTime);
                    var height = CalculateHeight(mainEntry.StartTime, mainEntry.EndTime);

                    <SubjectEntry Title="@mainEntry.Title"
                                  SubjectType="@mainEntry.SubjectType"
                                  ColorOverride="@mainEntry.Color"
                                  StartTime="@mainEntry.StartTime"
                                  EndTime="@mainEntry.EndTime"
                                  TopPx="@top"
                                  HeightPx="@height"
                                  DarkMode="@DarkMode"
                                  WeeksOfMonth="@mainEntry.WeeksOfMonth"
                                  CurrentWeekOfMonth="@CurrentWeekOfMonth"
                                  AlternateWeekEntries="@alternates" />
                }
            </div>
        </div>
    }
</div>


