@using Client.Components.Schedule

<div class="week-view-container">
    @* Header with classroom info and week navigation *@
    <div class="week-header">
        <div class="week-header-left">
            <div class="classroom-info">
                <i class="bi bi-building classroom-icon"></i>
                <div class="classroom-details">
                    <h6 class="classroom-name mb-0">@Classroom?.Name</h6>
                    <small class="classroom-grade text-white-50">@Classroom?.Grade â€¢ @Classroom?.Teacher</small>
                </div>
            </div>
        </div>

        <div class="week-header-center">
            <button class="btn btn-outline-light btn-sm nav-button" @onclick="NavigateToPreviousWeek">
                <i class="bi bi-chevron-left"></i>
            </button>
            <div class="week-date-display">
                <h6 class="week-title mb-0">@GetWeekTitle()</h6>
                <small class="week-subtitle text-white-50">@GetWeekDateRange()</small>
            </div>
            <button class="btn btn-outline-light btn-sm nav-button" @onclick="NavigateToNextWeek">
                <i class="bi bi-chevron-right"></i>
            </button>
        </div>

        <div class="week-header-right">
            <button class="btn btn-outline-light btn-sm today-button" @onclick="GoToCurrentWeek">
                <i class="bi bi-calendar-check me-1"></i>
                This Week
            </button>
        </div>
    </div>

    @* Subject legend *@
    <div class="subject-legend">
        @foreach (var subject in Subjects)
        {
            <div class="legend-item">
                <div class="legend-color" style="background-color: @subject.Color;"></div>
                <small>@subject.Code</small>
            </div>
        }
    </div>

    @* Schedule grid *@
    <div class="schedule-grid">
        @* Time column *@
        <div class="time-column">
            <div class="day-header-cell time-header">
                <i class="bi bi-clock text-muted"></i>
            </div>
            @foreach (var hour in GetHourSlots())
            {
                <div class="time-slot">
                    <small class="text-muted">@hour.ToString(@"hh\:mm")</small>
                </div>
            }
        </div>

        @* Day columns *@
        @foreach (var day in GetWeekDays())
        {
            var dayEntries = GetEntriesForDay(day);
            var isToday = day.Date == DateTime.Today;
            
            <div class="day-column @(isToday ? "today-column" : "")">
                <div class="day-header-cell @(isToday ? "today-header" : "")">
                    <small class="day-name text-uppercase">@day.ToString("ddd")</small>
                    <h6 class="day-number mb-0 @(isToday ? "today-number" : "")">@day.Day</h6>
                </div>
                
                <div class="day-schedule-area">
                    @if (IsLoading)
                    {
                        <div class="loading-placeholder">
                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    }
                    else
                    {
                        @foreach (var entry in dayEntries)
                        {
                            var topPosition = CalculateTopPosition(entry.StartTime);
                            var height = CalculateHeight(entry.DurationMinutes);
                            
                            <div class="schedule-entry" 
                                 style="top: @(topPosition)px; height: @(height)px; background-color: @entry.Color;"
                                 @onclick="() => HandleEntryClick(entry)">
                                <div class="entry-content">
                                    <div class="entry-header">
                                        <i class="bi @GetSubjectIcon(entry.Icon) entry-icon"></i>
                                        <span class="entry-subject">@entry.SubjectName</span>
                                    </div>
                                    @if (height > 50)
                                    {
                                        <small class="entry-time">
                                            @entry.StartTime.ToString(@"hh\:mm") - @entry.EndTime.ToString(@"hh\:mm")
                                        </small>
                                        <small class="entry-room">@entry.RoomNumber</small>
                                    }
                                </div>
                            </div>
                        }
                        
                        @* Show break/lunch indicators *@
                        @if (dayEntries.Any())
                        {
                            <div class="break-indicator" style="top: @(CalculateTopPosition(new TimeSpan(10, 5, 0)))px;">
                                <small class="break-text">Break</small>
                            </div>
                            <div class="break-indicator lunch-break" style="top: @(CalculateTopPosition(new TimeSpan(12, 0, 0)))px;">
                                <small class="break-text">Lunch</small>
                            </div>
                        }
                    }
                </div>
            </div>
        }
    </div>

    @* Selected entry detail panel *@
    @if (SelectedEntry != null)
    {
        <div class="card entry-detail-panel shadow">
            <div class="card-header detail-header text-white" style="background-color: @SelectedEntry.Color;">
                <div class="d-flex align-items-center">
                    <i class="bi @GetSubjectIcon(SelectedEntry.Icon) detail-icon me-2 fs-4"></i>
                    <h6 class="detail-title mb-0 flex-grow-1">@SelectedEntry.SubjectName</h6>
                    <button type="button" class="btn-close btn-close-white" @onclick="CloseDetailPanel"></button>
                </div>
            </div>
            <div class="card-body detail-content">
                <div class="detail-row">
                    <i class="bi bi-person text-muted me-2"></i>
                    <span>@SelectedEntry.TeacherName</span>
                </div>
                <div class="detail-row">
                    <i class="bi bi-clock text-muted me-2"></i>
                    <span>@SelectedEntry.StartTime.ToString(@"hh\:mm") - @SelectedEntry.EndTime.ToString(@"hh\:mm") (@SelectedEntry.DurationMinutes min)</span>
                </div>
                <div class="detail-row">
                    <i class="bi bi-geo-alt text-muted me-2"></i>
                    <span>@SelectedEntry.RoomNumber</span>
                </div>
                <div class="detail-row">
                    <i class="bi bi-calendar text-muted me-2"></i>
                    <span>@SelectedEntry.Day</span>
                </div>
            </div>
        </div>
    }
</div>
