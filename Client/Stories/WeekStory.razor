@page "/stories/week"
@layout StoryLayout
@using Client.Components.Schedule

<h4 class="mb-4" style="color: #495057;">Week Schedule View</h4>

<p class="mb-4 text-muted">
    A modern classroom week view displaying 8 subjects spread across 5 days (Monday - Friday).
    Click on any class to see details.
</p>

<div class="story-container">
    <div class="p-4">
        <Week ClassroomId="1"
              DisplayWeekStart="@_displayWeekStart"
              DisplayWeekStartChanged="HandleWeekChanged"
              OnEntryClick="HandleEntryClick" />
    </div>
</div>

@if (_lastClickedEntry != null)
{
    <div class="card mt-4 shadow-sm">
        <div class="card-body">
            <h6 class="card-subtitle mb-2">Last Clicked Entry:</h6>
            <p class="card-text mb-0">
                <strong>@_lastClickedEntry.SubjectName</strong> on @_lastClickedEntry.Day 
                at @_lastClickedEntry.StartTime.ToString(@"hh\:mm") - @_lastClickedEntry.EndTime.ToString(@"hh\:mm")
                in @_lastClickedEntry.RoomNumber with @_lastClickedEntry.TeacherName
            </p>
        </div>
    </div>
}

<hr class="my-4" />

<h5 class="mb-4" style="color: #495057;">Component Features</h5>

<div class="row">
    <div class="col-12 col-md-6 mb-3">
        <div class="card shadow-sm h-100">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-palette me-2"></i>
                    Visual Design
                </h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li><i class="bi bi-check text-success me-2"></i>Color-coded subjects for easy recognition</li>
                    <li><i class="bi bi-check text-success me-2"></i>Subject icons for quick identification</li>
                    <li><i class="bi bi-check text-success me-2"></i>Today highlighting with gradient</li>
                    <li><i class="bi bi-check text-success me-2"></i>Smooth hover animations</li>
                    <li><i class="bi bi-check text-success me-2"></i>Break and lunch time indicators</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="col-12 col-md-6 mb-3">
        <div class="card shadow-sm h-100">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-hand-index me-2"></i>
                    Interactions
                </h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li><i class="bi bi-check text-success me-2"></i>Week navigation (previous/next)</li>
                    <li><i class="bi bi-check text-success me-2"></i>"This Week" quick navigation</li>
                    <li><i class="bi bi-check text-success me-2"></i>Click entries for details panel</li>
                    <li><i class="bi bi-check text-success me-2"></i>Subject legend with hover effects</li>
                    <li><i class="bi bi-check text-success me-2"></i>Responsive layout for all screens</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<hr class="my-4" />

<h5 class="mb-4" style="color: #495057;">Subjects in Schedule</h5>

<div class="row">
    @foreach (var subject in WeekMockData.GetSubjects())
    {
        <div class="col-6 col-sm-4 col-md-3 mb-3">
            <div class="card shadow-sm p-3 d-flex flex-row align-items-center gap-3" style="border-left: 4px solid @subject.Color;">
                <i class="bi @GetIcon(subject.Icon)" style="color: @subject.Color; font-size: 1.5rem;"></i>
                <div>
                    <div class="fw-semibold">@subject.Name</div>
                    <small class="text-muted">@subject.Code</small>
                </div>
            </div>
        </div>
    }
</div>

@code {
    private DateTime _displayWeekStart = GetMondayOfWeek(DateTime.Today);
    private WeekMockData.ScheduleEntryDto? _lastClickedEntry;

    private static DateTime GetMondayOfWeek(DateTime date)
    {
        int diff = (7 + (date.DayOfWeek - DayOfWeek.Monday)) % 7;
        return date.AddDays(-diff).Date;
    }

    private void HandleWeekChanged(DateTime newWeekStart)
    {
        _displayWeekStart = newWeekStart;
        Console.WriteLine($"Week changed to: {newWeekStart:yyyy-MM-dd}");
    }

    private void HandleEntryClick(WeekMockData.ScheduleEntryDto entry)
    {
        _lastClickedEntry = entry;
        Console.WriteLine($"Entry clicked: {entry.SubjectName} on {entry.Day}");
    }

    private string GetIcon(string iconName)
    {
        return iconName switch
        {
            "Calculate" => "bi-calculator",
            "MenuBook" => "bi-book",
            "Science" => "bi-mortarboard",
            "HistoryEdu" => "bi-clock-history",
            "Public" => "bi-globe",
            "Palette" => "bi-palette",
            "MusicNote" => "bi-music-note-beamed",
            "FitnessCenter" => "bi-trophy",
            _ => "bi-book"
        };
    }
}
